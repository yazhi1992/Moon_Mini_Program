<!--miniprogram/pages/history/history.wxml-->

<!-- 悬浮按钮 -->
<view class='root'>
  <view wx:for="{{datas}}" wx:for-item="item" wx:for-index="idx" wx:key="_id" catchlongtap="longTap" data-content="{{item}}">
    <view class='itemBox'>
      <image class='userImg' src='{{item.user.imgUrl}}'></image>
      <view class='rightContent'>
        <text class='userNameText'>{{item.user.name}}</text>
        <!-- 心声 -->
        <view wx:if="{{item.contentType=='0'}}" class='contentDetail'>
          <text class='contentText'>{{item.content.content}}</text>
          <dimage class='contentImg' src='{{item.content.imgId}}' bindtap='clickImg' catchlongpress='longClickImg' data-src='{{item.content.imgId}}' wx:if="{{item.content.imgId}}" style="width:{{item.content.imgwidth}}rpx; height:{{item.content.imgheight}}rpx;"></dimage>
        </view>
        <!-- 倒数日 -->
        <view wx:elif="item.contentType=='1'" class='contentDetail'>
          <text class='memorialTitle' style='height=100rpx'>添加了纪念日</text>
          <text class='memorialTitle' style='height=100rpx'>{{item.content.title}}   {{item.content.dayGap}}</text>
        </view>
        <!-- 许下小心愿 -->
        <view wx:elif="item.contentType=='3'">
          <text class='commentText' style='height=100rpx'>{{item.comment}}</text>
        </view>
        <!-- 达成心愿 -->
        <view wx:elif="item.contentType=='4'">
          <text class='commentText' style='height=100rpx'>{{item.comment}}</text>
        </view>
        <!-- 姨妈来了 -->
        <view wx:elif="item.contentType=='4'">
          <text class='commentText' style='height=100rpx'>{{item.comment}}</text>
        </view>
        <!-- 姨妈走了 -->
        <view wx:else="item.contentType=='5'">
          <text class='commentText' style='height=100rpx'>{{item.comment}}</text>
        </view>
        <!-- 评论 -->
        <view class='commentRoot' wx:if="{{item.comments.length}}">
          <view wx:for="{{item.comments}}" wx:for-item="comment" wx:key="" class='commentBox' catchlongtap="longTapComment" catchtap="clickComment" data-comment="{{comment}}" data-content="{{item}}">
            <text class='nameText'>{{comment.user.name}}</text>
            <text class='commentText' hidden="{{!comment.replyUser.name}}">回复</text>
            <text class='nameText' hidden="{{!comment.replyUser.name}}">{{comment.replyUser.name}}</text>
            <text class='commentText'> ：</text>
            <!--<text class='commentText' style="white-space:pre-line">{{comment.comment}}</text>-->
            <!--<text class='commentText' style="white-space:pre-wrap">{{comment.comment}}</text>-->
            <text class='commentContent'>{{comment.comment}}</text>
          </view>
        </view>
        <!-- 时间 / 点击评论-->
        <view style="display:flex;align-items:center">
          <text class='timeText'>{{item.content.createAt}}</text>
          <image class='commentImg' src='./comment_icon.png' bindtap="addComment" data-content="{{item}}"></image>
        </view>
      </view>
    </view>
    <!-- 分隔线 -->
    <view class="divLine" ></view>
  </view>
  <!-- 加载更多 -->
  <view class="load_more" hidden="{{!pullUp}}">
    <view class="load_loading"></view>
    <view class="load-tips">正在加载...</view>
  </view>
  <view class="load_more" hidden="{{!nomoreData}}">没有更多数据了</view>
</view>

<droot class='myroot' binddroottap="drootCallback" status="{{drootStatus}}">
</droot>

<image class='floatBtn' src='./add.png' bindtap="clickAdd"></image>

<!-- 评论输入框 -->
<view class="input" style="bottom:{{inputBottom}}px;" hidden="{{inputBottom==0}}">
  <view class='edittext'>
    <input value="{{input}}" focus="{{focus}}" placeholder="{{inputHint}}" bindinput="bindKeyInput" adjust-position="{{false}}" bindfocus="inputFocus" bindblur="inputBlur" />
  </view>
  <button class="btn" hover-class='btnHover' type="primary" bindtap="sendComment">发送</button>
</view>
